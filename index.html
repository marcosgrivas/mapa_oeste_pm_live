let manzanasLayer;
let currentZoom = map.getZoom();

function getTooltipText(props, zoom) {
  if (zoom < 15) return null;
  if (zoom < 17) return `Territorio ${props.id_terr}`;
  return `T ${props.id_terr} â€“ Mza ${props.id_mza}`;
}

fetch('manzanas.geojson')
  .then(res => res.json())
  .then(data => {
    manzanasLayer = L.geoJSON(data, {
      style: feature => ({
        color: '#333',
        weight: 1,
        fillColor: colorPorTerritorio(feature.properties.id_terr),
        fillOpacity: 0.5
      }),
      onEachFeature: (feature, layer) => {
        const text = getTooltipText(feature.properties, currentZoom);
        if (text) {
          layer.bindTooltip(text, {
            permanent: true,
            direction: 'center',
            className: 'mza-label'
          });
        }
      }
    }).addTo(map);

    map.fitBounds(manzanasLayer.getBounds());
  });

// Recalcular etiquetas al cambiar zoom
map.on('zoomend', () => {
  currentZoom = map.getZoom();
  manzanasLayer.eachLayer(layer => {
    layer.unbindTooltip();
    const props = layer.feature.properties;
    const text = getTooltipText(props, currentZoom);
    if (text) {
      layer.bindTooltip(text, {
        permanent: true,
        direction: 'center',
        className: 'mza-label'
      });
    }
  });
});
